{"title":"Email Service Dashboard","description":"Comprehensive monitoring dashboard for email-service including service usage, latency, and SNS/SQS metrics","widgets":[{"id":1,"definition":{"title":"Email Service Overview","type":"group","layout_type":"ordered","widgets":[{"id":2,"definition":{"title":"Outgoing Emails Rate vs Failures (per minute)","show_legend":true,"legend_layout":"horizontal","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:email.outgoing{*}.as_rate()"},{"data_source":"metrics","name":"query2","query":"sum:email.outgoing.failure{*}.as_rate()"}],"formulas":[{"alias":"Outgoing emails","formula":"query1"},{"alias":"Failures","formula":"query2"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"label":"emails/min","scale":"linear"}},"layout":{"x":0,"y":0,"width":12,"height":2}},{"id":4,"definition":{"title":"Incoming Emails Rate","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:email.incoming{*}.as_rate()"}],"formulas":[{"alias":"Incoming emails","formula":"query1"}],"style":{"palette":"cool","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"label":"emails/min","scale":"linear"}},"layout":{"x":0,"y":2,"width":4,"height":3}},{"id":5,"definition":{"title":"Email Bounces by Type","show_legend":true,"legend_layout":"vertical","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:email.bounce{*} by {subtype,type}.as_rate()"}],"formulas":[{"alias":"Bounced emails","formula":"query1"}],"style":{"palette":"red","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"label":"bounces/min","scale":"linear"}},"layout":{"x":4,"y":2,"width":8,"height":3}},{"id":968186045888665,"definition":{"title":"Number of published email messages from services","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"vertical","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"name":"query1","data_source":"logs","search":{"query":"\"Publishing outgoing email to email service queue to\" AND NOT service:*hibob*"},"indexes":["*"],"group_by":[{"facet":"service","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count","interval":1000},"storage":"hot"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":0,"y":5,"width":6,"height":4}},{"id":5332075353958380,"definition":{"title":"Throughput of published email messages from services","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"vertical","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"throughput(query1)"}],"queries":[{"name":"query1","data_source":"logs","search":{"query":"\"Publishing outgoing email to email service queue to\" AND NOT service:*hibob*"},"indexes":["*"],"group_by":[{"facet":"service","limit":25,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count","interval":1000},"storage":"hot"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":6,"y":5,"width":6,"height":4}},{"id":7195421836298511,"definition":{"title":"Number of published email messages from hibob","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"vertical","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"name":"query1","data_source":"logs","search":{"query":"\"Publishing outgoing email to email service queue to\" AND service:*hibob*"},"indexes":["*"],"group_by":[{"facet":"service","limit":25,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count","interval":1000},"storage":"hot"}],"formulas":[{"formula":"query1"}],"style":{"palette":"warm","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":0,"y":9,"width":6,"height":4}},{"id":421938845550661,"definition":{"title":"Throughput of published email messages from hibob","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"vertical","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"name":"query1","data_source":"logs","search":{"query":"\"Publishing outgoing email to email service queue to\" AND service:*hibob*"},"indexes":["*"],"group_by":[{"facet":"service","limit":25,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count","interval":1000},"storage":"hot"}],"formulas":[{"formula":"throughput(query1)"}],"style":{"palette":"warm","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":6,"y":9,"width":6,"height":4}},{"id":3010281714463078,"definition":{"title":"ses delivery send","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"vertical","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:aws.ses.send.sum{*}.as_count()"}],"formulas":[{"formula":"query1"}],"style":{"palette":"warm","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":0,"y":13,"width":6,"height":4}},{"id":8952745418062590,"definition":{"title":"throttling ","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"vertical","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"name":"query1","data_source":"logs","search":{"query":"\"Throttling: Maximum sending rate exceeded. Sending limit reached for pool\""},"indexes":["*"],"group_by":[],"compute":{"aggregation":"count"},"storage":"hot"}],"formulas":[{"formula":"query1"}],"style":{"palette":"warm","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":6,"y":13,"width":6,"height":4}},{"id":5046916321481678,"definition":{"title":"ses 24h quota usage","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"vertical","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"max:aws.ses.sent_last_24_hours{*}"},{"data_source":"metrics","name":"query2","query":"max:aws.ses.max_24_hour_send{*}"}],"formulas":[{"formula":"query1"},{"formula":"query2"},{"formula":"query1 / query2"}],"style":{"palette":"warm","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":0,"y":17,"width":6,"height":4}},{"id":119120931200578,"definition":{"title":"ses delivery attempts","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"vertical","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:aws.ses.deliveryattempts{*}"}],"formulas":[{"formula":"query1"}],"style":{"palette":"warm","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":6,"y":17,"width":6,"height":4}},{"id":2586257481437562,"definition":{"title":"ses delivery bounces","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"vertical","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:aws.ses.bounce.sum{*}"}],"formulas":[{"formula":"query1"}],"style":{"palette":"warm","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":6,"y":21,"width":6,"height":4}}]},"layout":{"x":0,"y":0,"width":12,"height":26}},{"id":6,"definition":{"title":"Service Usage & Latency","type":"group","layout_type":"ordered","widgets":[{"id":7,"definition":{"title":"Queue Message Processing Rate","show_legend":true,"legend_layout":"horizontal","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:handle.message{service:email-service} by {type}.as_rate()"}],"formulas":[{"formula":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"label":"messages/min","scale":"linear"}},"layout":{"x":0,"y":0,"width":6,"height":3}},{"id":8,"definition":{"title":"Queue Processing Errors","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:handle.message{type:error*} by {type}.as_rate()"}],"formulas":[{"formula":"query1"}],"style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"label":"errors/min","scale":"linear"}},"layout":{"x":6,"y":0,"width":6,"height":3}},{"id":9,"definition":{"title":"Email Service HTTP Request Rate","show_legend":true,"legend_size":"0","legend_layout":"auto","type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:trace.spring.request{service:email-service,resource_name:*} by {resource_name}.as_rate()"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"label":"requests/min","scale":"linear"}},"layout":{"x":0,"y":3,"width":6,"height":3}},{"id":10,"definition":{"title":"Email Service HTTP Latency (P95)","show_legend":true,"legend_layout":"auto","type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"p95:trace.spring.request.duration{service:email-service,resource_name:*}.rollup(avg, 300)"}],"style":{"palette":"cool","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"label":"ms","scale":"linear"}},"layout":{"x":6,"y":3,"width":6,"height":3}}]},"layout":{"x":0,"y":26,"width":12,"height":7}},{"id":11,"definition":{"title":"SNS/SQS Infrastructure Metrics","type":"group","layout_type":"ordered","widgets":[{"id":5037937566051123,"definition":{"title":"Outgoing Emails Topic - Message Flow","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:aws.sns.number_of_messages_published{topicname:hibob-dev-local-eu-west-1-outgoing-email-requests} by {topicname}.as_rate()"}],"formulas":[{"formula":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"},{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:aws.sqs.number_of_messages_received{queuename:*outgoing*} by {queuename}.as_rate()"}],"formulas":[{"formula":"query1"}],"style":{"palette":"cool","line_type":"solid","line_width":"normal"},"display_type":"line"},{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"avg:aws.sqs.approximate_number_of_messages{queuename:*outgoing*} by {queuename}"}],"style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"label":"messages/min","scale":"linear"}},"layout":{"x":0,"y":0,"width":6,"height":3}},{"id":14,"definition":{"title":"SQS Messages Received","show_legend":true,"legend_size":"0","legend_layout":"auto","type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:aws.sqs.number_of_messages_received{service:email-service} by {queuename}.as_rate()"}],"style":{"palette":"cool","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"label":"messages/min","scale":"linear"}},"layout":{"x":6,"y":0,"width":6,"height":3}},{"id":12,"definition":{"title":"SNS Topic Message Count","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:aws.sns.number_of_messages_published{topicname:cloud-delivery} by {topicname}.as_rate()"}],"formulas":[{"formula":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"label":"messages/min","scale":"linear"}},"layout":{"x":0,"y":3,"width":6,"height":3}},{"id":13,"definition":{"title":"SQS Queue Depth: approximate number of messages","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"avg:aws.sqs.approximate_number_of_messages_visible{queuename:email*-prod} by {queuename}"},{"data_source":"metrics","name":"query2","query":"avg:aws.sqs.approximate_number_of_messages_not_visible{queuename:email*-prod} by {queuename}"},{"data_source":"metrics","name":"query3","query":"avg:aws.sqs.approximate_number_of_messages_delayed{queuename:email*-prod} by {queuename}"}],"formulas":[{"alias":"Visible","formula":"query1"},{"alias":"Not visible","formula":"query2"},{"alias":"Delayed","formula":"query3"}],"style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"label":"messages","scale":"linear"}},"layout":{"x":6,"y":3,"width":6,"height":3}},{"id":15,"definition":{"title":"SQS Messages Deleted","show_legend":true,"legend_layout":"horizontal","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:aws.sqs.number_of_messages_deleted{service:email-service} by {queuename}.as_rate()"}],"formulas":[{"formula":"query1"}],"style":{"palette":"green","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"label":"messages/min","scale":"linear"}},"layout":{"x":0,"y":6,"width":12,"height":2}}]},"layout":{"x":0,"y":0,"width":12,"height":9,"is_column_break":true}},{"id":16,"definition":{"title":"Service Health & Performance","type":"group","layout_type":"ordered","widgets":[{"id":17,"definition":{"title":"JVM Memory Usage","show_legend":true,"legend_size":"0","legend_layout":"auto","type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"avg:jvm.memory.used{service:email-service} by {type}"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"area"}],"yaxis":{"label":"bytes","scale":"linear"}},"layout":{"x":0,"y":0,"width":4,"height":2}},{"id":18,"definition":{"title":"JVM GC Pause Time","show_legend":true,"legend_size":"0","legend_layout":"auto","type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:jvm.gc.pause{service:email-service} by {action}.as_rate()"}],"style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"label":"ms/min","scale":"linear"}},"layout":{"x":4,"y":0,"width":4,"height":2}},{"id":19,"definition":{"title":"Thread Pool Active Threads","show_legend":true,"legend_size":"0","legend_layout":"auto","type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"avg:thread.pool.active{service:email-service} by {pool.name}"}],"style":{"palette":"cool","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"label":"threads","scale":"linear"}},"layout":{"x":8,"y":0,"width":4,"height":2}},{"id":20,"definition":{"title":"Database Connection Pool","show_legend":true,"legend_size":"0","legend_layout":"auto","type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"avg:hikaricp.connections.active{service:email-service}"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"},{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"avg:hikaricp.connections.idle{service:email-service}"}],"style":{"palette":"cool","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"label":"connections","scale":"linear"}},"layout":{"x":0,"y":2,"width":4,"height":2}}]},"layout":{"x":0,"y":9,"width":12,"height":5}},{"id":21,"definition":{"title":"Service Usage Breakdown","type":"group","layout_type":"ordered","widgets":[{"id":22,"definition":{"title":"Top Services Using Email (by HTTP requests)","type":"toplist","requests":[{"style":{"palette":"dog_classic"},"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"sum:trace.spring.request{service:email-service,resource_name:*} by {resource_name}","aggregator":"avg"}],"formulas":[{"formula":"query1"}],"sort":{"order_by":[{"type":"formula","index":0,"order":"desc"}]}}]},"layout":{"x":0,"y":0,"width":4,"height":2}},{"id":23,"definition":{"title":"Email Event Types Distribution","type":"toplist","requests":[{"style":{"palette":"dog_classic"},"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"sum:email.outgoing{service:email-service} by {event.type}","aggregator":"avg"}],"formulas":[{"formula":"query1"}],"sort":{"order_by":[{"type":"formula","index":0,"order":"desc"}]}}]},"layout":{"x":4,"y":0,"width":4,"height":2}},{"id":24,"definition":{"title":"Queue Processing Success Rate","show_legend":true,"legend_layout":"auto","type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:handle.message{service:email-service,type:completed}.as_rate()"},{"data_source":"metrics","name":"query2","query":"sum:handle.message{service:email-service,type:error}.as_rate()"}],"formulas":[{"formula":"query1 / (query1 + query2) * 100"}],"style":{"palette":"green","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"label":"%","scale":"linear","min":"0","max":"100"}},"layout":{"x":8,"y":0,"width":4,"height":2}},{"id":25,"definition":{"title":"Email Service Error Rate","show_legend":true,"legend_layout":"auto","type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:trace.spring.request{service:email-service,error:true}.as_rate()"},{"data_source":"metrics","name":"query2","query":"sum:trace.spring.request{service:email-service}.as_rate()"}],"formulas":[{"formula":"query1 / query2 * 100"}],"style":{"palette":"red","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"label":"%","scale":"linear","min":"0","max":"100"}},"layout":{"x":0,"y":2,"width":4,"height":2}}]},"layout":{"x":0,"y":14,"width":12,"height":5}},{"id":26,"definition":{"title":"Alerts & Thresholds","type":"group","layout_type":"ordered","widgets":[{"id":27,"definition":{"title":"High Queue Depth Alert","type":"query_value","requests":[{"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"max:aws.sqs.approximate_number_of_messages{service:email-service}","aggregator":"max"}]}],"custom_unit":"messages","precision":0},"layout":{"x":0,"y":0,"width":4,"height":2}},{"id":28,"definition":{"title":"Email Failure Rate Alert","type":"query_value","requests":[{"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"sum:email.outgoing.failure{service:email-service}.as_rate()","aggregator":"max"},{"data_source":"metrics","name":"query2","query":"sum:email.outgoing{service:email-service}.as_rate()","aggregator":"max"}],"formulas":[{"formula":"query1 / query2 * 100"}]}],"custom_unit":"%","precision":1},"layout":{"x":4,"y":0,"width":4,"height":2}},{"id":29,"definition":{"title":"HTTP Error Rate Alert","type":"query_value","requests":[{"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"sum:trace.spring.request{service:email-service,error:true}.as_rate()","aggregator":"max"},{"data_source":"metrics","name":"query2","query":"sum:trace.spring.request{service:email-service}.as_rate()","aggregator":"max"}],"formulas":[{"formula":"query1 / query2 * 100"}]}],"custom_unit":"%","precision":2},"layout":{"x":8,"y":0,"width":4,"height":2}}]},"layout":{"x":0,"y":19,"width":12,"height":3}},{"id":7257413365508813,"definition":{"title":"","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query2","query":"max:aws.lambda.invocations{functionname:cloud-delivery-prod-email-publish}.as_rate()"}],"formulas":[{"formula":"query2"}],"style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":0,"y":0,"width":4,"height":2}}],"template_variables":[],"layout_type":"ordered","notify_list":[],"pause_auto_refresh":false,"reflow_type":"fixed"}